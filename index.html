<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Финансовый отчет</title>
</head>
<body>

<h1>Финансовый отчет</h1>

<!-- Форма для ввода данных -->
<h2>Добавить данные</h2>
<form id="expenseForm">
    <label for="amount">Сумма:</label>
    <input type="number" id="amount" required><br>

    <label for="date">Дата:</label>
    <input type="date" id="date" required><br>

    <label for="category">Категория:</label>
    <select id="category">
        <option value="income">Доход</option>
        <option value="expense">Расход</option>
        <option value="savings">Сбережения</option>
        <option value="withdrawal">Снятие средств</option>
    </select><br>

    <button type="submit">Добавить</button>
</form>

<!-- Отчеты -->
<h2>Сводная информация</h2>
<table>
    <thead>
        <tr>
            <th>Общий доход</th>
            <th>Общие расходы</th>
            <th>Общие сбережения</th>
            <th>Общий баланс кошелька</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td id="totalDeposited">0</td>
            <td id="totalSpent">0</td>
            <td id="totalSavings">0</td>
            <td id="walletBalance">0</td>
        </tr>
    </tbody>
</table>

<h2>История транзакций</h2>
<table id="reportTable">
    <thead>
        <tr>
            <th>Категория</th>
            <th>Сумма</th>
            <th>Дата</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- Управление данными -->
<button onclick="saveToFile()">Сохранить в файл</button>
<input type="file" onchange="loadFromFile(event)" />
<button onclick="clearData()">Очистить данные</button>

<script>
    let data = {
        income: [],
        expenses: [],
        savings: { main: [], emergency: [] },
        withdrawals: { main: [], emergency: [] },
        walletBalance: 0,
        mainAccountBalance: 0,
        emergencyAccountBalance: 0
    };

    const saveData = (newData) => {
        data = { ...newData };
        localStorage.setItem('financeData', JSON.stringify(data));
        updateSummaryTable();
        updateReportTable(data);
    };

    // Загрузка данных из LocalStorage при загрузке страницы
    window.onload = () => {
        const savedData = localStorage.getItem('financeData');
        if (savedData) {
            saveData(JSON.parse(savedData));
        }
    };

    // Добавление данных
    document.getElementById('expenseForm').addEventListener('submit', (e) => {
        e.preventDefault();

        const amount = parseFloat(document.getElementById('amount').value);
        const date = document.getElementById('date').value;
        const category = document.getElementById('category').value;

        if (category === 'income') {
            data.income.push({ amount, date });
            data.walletBalance += amount;
        } else if (category === 'expense') {
            data.expenses.push({ amount, date });
            data.walletBalance -= amount;
        } else if (category === 'savings') {
            data.savings.main.push({ amount, date });
            data.mainAccountBalance += amount;
        } else if (category === 'withdrawal') {
            data.withdrawals.main.push({ amount, date });
            data.walletBalance -= amount;
        }

        saveData(data);
    });

    const updateReportTable = (report) => {
        const tbody = document.querySelector('#reportTable tbody');
        tbody.innerHTML = '';

        const allData = [
            ...report.income.map(item => ({ ...item, category: 'Доход' })),
            ...report.expenses.map(item => ({ ...item, category: 'Расход' })),
            ...report.savings.main.map(item => ({ ...item, category: 'Сбережения' })),
            ...report.withdrawals.main.map(item => ({ ...item, category: 'Снятие средств' }))
        ];

        allData.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.category}</td>
                <td>${item.amount}</td>
                <td>${item.date}</td>
            `;
            tbody.appendChild(row);
        });
        updateSummaryTable();
    };

    const updateSummaryTable = () => {
        const totalIncome = data.income.reduce((sum, entry) => sum + entry.amount, 0);
        const totalExpenses = data.expenses.reduce((sum, entry) => sum + entry.amount, 0);
        const totalSavings = data.savings.main.reduce((sum, entry) => sum + entry.amount, 0);
        const totalWithdrawals = data.withdrawals.main.reduce((sum, entry) => sum + entry.amount, 0);

        document.getElementById('totalDeposited').textContent = totalIncome;
        document.getElementById('totalSpent').textContent = totalExpenses;
        document.getElementById('totalSavings').textContent = totalSavings;
        document.getElementById('walletBalance').textContent = data.walletBalance;
    };

    const saveToFile = () => {
        const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'finance_data.json';
        a.click();
    };

    const loadFromFile = (event) => {
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onload = () => {
            const fileData = JSON.parse(reader.result);
            saveData(fileData);
        };

        reader.readAsText(file);
    };

    const clearData = () => {
        localStorage.removeItem('financeData');
        data = {
            income: [],
            expenses: [],
            savings: { main: [], emergency: [] },
            withdrawals: { main: [], emergency: [] },
            walletBalance: 0,
            mainAccountBalance: 0,
            emergencyAccountBalance: 0
        };
        updateSummaryTable();
        updateReportTable(data);
    };
</script>

</body>
</html>
