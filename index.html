<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Финансовый трекер</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f3f4f6;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        input[type="number"] {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
        }
        button:disabled {
            background: #cccccc;
        }
        .balance-display {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>Финансовый трекер</h2>
    
    <div class="balance-display">
        <div>Баланс кошелька: <span id="walletBalance">0</span> руб.</div>
        <div>Сберегательный счёт: <span id="savingsBalance">0</span> руб.</div>
        <div>Экстренный счёт: <span id="emergencyBalance">0</span> руб.</div>
    </div>

    <input type="number" id="amount" placeholder="Введите сумму">
    
    <div class="buttons">
        <button onclick="handleOperation('income')" class="income-btn" disabled>Получил</button>
        <button onclick="handleOperation('expense')" class="expense-btn" disabled>Потратил</button>
        <button onclick="handleOperation('toSavings')" class="transfer-btn" disabled>Перевел на сберегательный</button>
        <button onclick="handleOperation('toEmergency')" class="transfer-btn" disabled>Перевел на экстренный</button>
        <button onclick="handleOperation('fromSavings')" class="withdraw-btn" disabled>Взял со сберегательного</button>
        <button onclick="handleOperation('fromEmergency')" class="withdraw-btn" disabled>Взял с экстренного</button>
    </div>

    <div class="file-actions">
        <button onclick="saveToFile()">Сохранить в файл</button>
        <input type="file" id="fileInput" onchange="loadFromFile(event)">
        <button onclick="clearAll()">Очистить всё</button>
    </div>

    <h3>Отчет:</h3>
    <button onclick="generateReport(30)">За месяц</button>
    <button onclick="generateReport(90)">За 3 месяца</button>
    <button onclick="generateReport(180)">За 6 месяцев</button>
    
    <div id="reportContainer" class="hidden">
        <table id="reportTable">
            <thead>
                <tr>
                    <th>Операция</th>
                    <th>Сумма</th>
                    <th>Дата</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
let data = {
    wallet: 0,
    savings: 0,
    emergency: 0,
    transactions: []
};

const saveToStorage = () => localStorage.setItem('financeData', JSON.stringify(data));
const loadFromStorage = () => {
    try {
        const stored = localStorage.getItem('financeData');
        if (stored) data = JSON.parse(stored);
    } catch {}
    updateBalances();
};

function updateButtons() {
    const amount = document.getElementById('amount').value;
    document.querySelectorAll('button').forEach(btn => btn.disabled = !amount);
}

function handleOperation(type) {
    const amount = parseFloat(document.getElementById('amount').value);
    if (!amount) return;

    const transaction = {
        type,
        amount,
        date: new Date().toISOString().split('T')[0]
    };

    switch(type) {
        case 'income':
            data.wallet += amount;
            break;
        case 'expense':
            data.wallet -= amount;
            break;
        case 'toSavings':
            data.wallet -= amount;
            data.savings += amount;
            break;
        case 'toEmergency':
            data.wallet -= amount;
            data.emergency += amount;
            break;
        case 'fromSavings':
            data.savings -= amount;
            data.wallet += amount;
            break;
        case 'fromEmergency':
            data.emergency -= amount;
            data.wallet += amount;
            break;
    }

    data.transactions.push(transaction);
    saveToStorage();
    document.getElementById('amount').value = '';
    updateBalances();
    updateButtons();
}

function updateBalances() {
    document.getElementById('walletBalance').textContent = data.wallet.toFixed(2);
    document.getElementById('savingsBalance').textContent = data.savings.toFixed(2);
    document.getElementById('emergencyBalance').textContent = data.emergency.toFixed(2);
}

function generateReport(daysBack) {
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - daysBack);

    const filtered = data.transactions.filter(t => 
        new Date(t.date) >= cutoffDate
    );

    const report = {
        totalIncome: filtered.filter(t => t.type == 'income').reduce((sum, t) => sum + t.amount, 0),
        totalExpense: filtered.filter(t => t.type == 'expense').reduce((sum, t) => sum + t.amount, 0),
        walletBalance: data.wallet,
        savingsBalance: data.savings,
        emergencyBalance: data.emergency
    };

    const reportContainer = document.getElementById('reportContainer');
    reportContainer.classList.remove('hidden');

    const tableBody = document.querySelector('#reportTable tbody');
    tableBody.innerHTML = '';
    
    filtered.forEach(t => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${getTypeName(t.type)}</td>
            <td>${t.amount}</td>
            <td>${t.date}</td>
        `;
        tableBody.appendChild(row);
    });

    document.getElementById('totalIncome').textContent = report.totalIncome.toFixed(2);
    document.getElementById('totalExpense').textContent = report.totalExpense.toFixed(2);
}

function getTypeName(type) {
    const types = {
        income: 'Пополнение',
        expense: 'Расход',
        toSavings: 'Перевод на сберегательный',
        toEmergency: 'Перевод на экстренный',
        fromSavings: 'Снятие со сберегательного',
        fromEmergency: 'Снятие с экстренного'
    };
    return types[type];
}

function saveToFile() {
    const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'finance_data.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
}

function loadFromFile(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            data = JSON.parse(e.target.result);
            saveToStorage();
            updateBalances();
            alert('Данные загружены');
        } catch {
            alert('Ошибка формата файла');
        }
    };
    reader.readAsText(file);
}

function clearAll() {
    if (confirm('Удалить все данные?')) {
        data = {
            wallet: 0,
            savings: 0,
            emergency: 0,
            transactions: []
        };
        saveToStorage();
        updateBalances();
        document.getElementById('reportContainer').classList.add('hidden');
    }
}

// Инициализация
loadFromStorage();
updateButtons();
updateBalances();
</script>
</body>
</html>
